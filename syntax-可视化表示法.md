Luna是数据处理语言并且如别的语言一样有自己的语法。

不同于别的语言，Luna有不止一种语法：可视化、文本。

可视化表示法利用文本表示法定义组件表达式。

# 可视化表示法
在设计可视化表示法的过程中，大量强调生产效率和人类工程学。

每个元素和动作都被细心设计来易于表达用户的想法，快速理解结果，清晰地查看所有数据的传输转换。

必须学会如何讲这门语言，无论怎样，都值得做，因为就连核心编码人员都倾向于采用Luna来构建高级数据处理工作流（而不是写代码）。

Luna的使命之一就是不断提升用Luna来完成工作的方式，用户的反馈和建议非常重要。

有任何有关可视化表示法应用的想法，请[告知作者][0]。

## 导航

Luna可视化编辑器是张画布，允许流畅的操作，这样用户总是聚焦在重要的事情上。

- 两根手指拖拽动作或鼠标滚轮按键来平铺视图。
- 两根手指捏叉动作或鼠标右边按键来缩放试图。
- 一根手指点击动作或鼠标左边按键来选择节点（被选中的节点从后台返回前台来执行）。
- 一根手指双击动作或鼠标左边按键来进入节点。
- 双击背景或可视化编辑器顶部的breadcrumb控件来查看亲代节点。

## 节点
可视化表达方式中，节点时最主要的入口，和别的节点一起组成数据流图。

### 值节点
是最常用的节点类型。

表示任何有效的Luna值，包括数据处理函数。

从上层看，一个值节点可以产生数据，修改或传递数据到某些外部服务（Web或DB）。

值节点由若干可视化元素组成：

![][1]

- 节点表达式
  - 1
  - 任何有效的Luna代码，特别是函数名，例如一个把两个对象相加的节点名为“+”
- 节点名称
  - 2
  - 描述节点在图中的角色，别的节点通过该名称引用此节点
- 输入端口和输出端口
  - 3、4
  - 节点通信的门户
  - 数据从左侧的输入端口进、根据节点表达式处理、结果从右侧的输出端口出
  - 端口颜色表明流过的数据类型
  - 数据类型[后边][2]详述
- 自身端口
  - 5
  - Luna也是面向对象的语言
  - 意味着节点之间流动的任何数据片段不只是信息，可以响应命令
  - 就像让车停止、让狗喊叫
  - 又如数值增长、列表排序
  - 如果数据连接到自身端口，节点表达式说明要对数据做什么
  - 一个经验法则（a rule of thumb）是若想处理数据片段就连接到自身端口
  - 有关[自定义类型][3]后边详述

### 引用节点
有时候用户不想处理数据，而是想检查解构数据。

需要注意的是，不是对数据造成影响，而是允许观察，叫做引用节点。

放在[模式匹配][4]一节详述。

包含特殊的端口，接受用户想要检查析构的数据。

![][5]

## 创建节点
总是在Luna探测器的帮助下创建节点。然而，有几个选项来启动节点、引导用户的意图。

- 按下<kbd>Tab</kbd>键搜索所有可用的组件。
- 选择一个节点然后按下<kbd>Tab</kbd>键引导探测器查找能处理结果的函数。

## 连接和断开节点
连接新的数据流，永续必须创建输出接口和输入接口之间的连接（包括自身接口）。

没有最好的方法，取决于用户的喜好、图的复杂程度、缩放水平等等。

Luna提供集中可选的方式来连接和断开节点，用户自行选择最适合自己情形的。

### 连接节点
- 拖拽

![][6]

摁住一个输出端口，拖动到目标输入端口或自身端口后放开。

此外还可以摁住一个输入端口，拖动到目标输出端口后放开。

然而，不能通过摁住自身端口开始一次连接，点击节点主体是选中整个节点。

在空白处放开可以取消本次连接。

- 点击

![][7]

点击（先摁下后释放）一个输出端口，连接会跟随到再次点击的位置，点击目标输入端口或自身端口来创建新的连接，在空白处点击可以取消本次连接。

也可以先在输入端口点击然后在输出端口点击。

- 画笔

![][8]

摁住同时按下<kbd>Ctrl</kbd>键，在屏幕（stage）上拖动来使用画笔的连接模式。

一条绿色的划线（stroke）跟随鼠标指针，把经过的节点全部连接起来。

此时，如果画笔连接两个节点，第一个节点的输出端口（结果）就会连接到第二个节点的自身端口。

这个功能马山会得到增强，将尝试带有类型匹配的端口连接创建。

- 创建节点顺手而为

![][9]

在打开探测器之前选择一个节点，引导该节点查找和该节点结果有关的函数并自动连接到新创建的节点的自身端口。

### 断开和重连接点
- 拖拽

![][a]

摁住连接的某一端来断开该连接并且进入“拖拽连接模式”。

可以拖动到别的端口上放开来重新连接。

可以拖动到空白处放开来删除该连接。

- 点击

![][b]

点击连接的某一端来断开该连接并且进入“点击连接模式”。

可以再次点击别的端口来重新连接。

可以再次点击空白处来删除该连接。

- 连接到已占用的端口

用上述任何方法在一个输入端口或自身端口创建新的连接，端口之间已经有连接的将被新的连接替代。

- 画笔

![][c]

摁住同时按下<kbd>Ctrl</kbd>键和<kbd>Shift</kbd>键，在屏幕上拖动画出一条线，将会把所有和改线交叉的连接断开。

## 节点详情视图
Luna允许用户以任何方式显示一个节点：紧凑的（上边的图）、详细的。

详细视图占用更多地屏幕空间。

但是，也会提供窗体小部件来交互地控制节点的输入值。

切换两种视图的方式是“选中目标节点后敲击<kbd>Enter</kbd>键”。

- 参数窗体小部件

![][d]

节点的每个输入都叫做参数。

参数可以由连接传递或手动在窗体小部件设置。

## 结果可视化
每个节点都可以将其结果可视化。

通过节点上的“小眼睛图标”来打开可视化。

如果同时按下“空格键”，可视化将进入全屏模式。

也可以按下“空格键”和<kbd>Enter</kbd>键来锁定全屏模式，按下<kbd>Esc</kbd>键退出全屏模式。

可以在可视化左侧的下拉菜单选择可用的可视化（方式）。

**即将改变**

	目前，结果可视化仅在无参数节点内可用。如果在工作空间的左手边工具条有任何参数，这意味着该节点依赖这些参数并且不能计算结果。这一点马上会修改，将能检查带给定输入参数的结果。详情参考函数节。

很多可视化提供交互式控件。

为了访问这些空间，必须点击使其获得焦点。

当用户聚焦一个可视化，图变灰色且不受控，除非通过<kbd>Esc</kbd>或者点击空白处退出聚焦。

---
[0]:https://discuss.luna-lang.org/
[1]:./images/node-with-self-and-parameters.png
[2]:./types.md
[3]:./classes.md
[4]:./pattern-matching.md
[5]:./images/reference-node.png
[6]:./images/connect-drag.gif
[7]:./images/connect-click.gif
[8]:./images/connect-pen.gif
[9]:./images/connect-auto.gif
[a]:./images/disconnect-drag.gif
[b]:./images/disconnect-click.gif
[c]:./images/disconnection-pen.gif
[d]:./images/expanded-node.png